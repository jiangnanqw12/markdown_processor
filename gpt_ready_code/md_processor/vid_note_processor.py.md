"vid_note_processor.py": "'import os\nimport re\nimport file_operations_utils\nimport pyperclip\nimport flags_utils\nimport shutil\nimport prompt_generator\nimport urllib.parse\ndef srt_format_4_gpt(directory_path=None):\n\tif directory_path is None:\n\t\tdirectory_path = os.getcwd()\n\tfiles_srt = [f for f in os.listdir(directory_path) if f.endswith(\'.srt\')]\n\tfor file in files_srt:\n\t\twith open(os.path.join(directory_path, file), "r", encoding="utf-8") as f1:\n\t\t\tlines = f1.readlines()\n\t\tcontent = \'\'\n\t\tfor line in lines:\n\t\t\tline_temp = line.strip()\n\t\t\tcontent += line_temp\n\t\treg_srt_2_gpt1 = [\n\t\t\tr\'\\d{1,3}(\\d{2}:\\d{2}:\\d{2}),\\d{3} --> \\d{1,2}:\\d{2}:\\d{2},\\d{3}\', r\'\\n(\\1) \']\n\t\treg_srt_2_gpt = reg_srt_2_gpt1\n\t\tcontent = re.sub(reg_srt_2_gpt[0], reg_srt_2_gpt[1], content)\n\t\twith open(os.path.join(directory_path, file), "w", encoding="utf-8") as f1:\n\t\t\tf1.write(content)\n\tif files_srt != []:\n\t\tprint(files_srt)\n\t\tprompt_generator.video_summarization_expert_one(content)\ndef vtt_format_4_gpt(directory_path=None):\n\tif directory_path is None:\n\t\tdirectory_path = os.getcwd()\n\tfiles_srt = [f for f in os.listdir(directory_path) if f.endswith(\'.vtt\')]\n\tfor file in files_srt:\n\t\twith open(os.path.join(directory_path, file), "r", encoding="utf-8") as f1:\n\t\t\tlines = f1.readlines()\n\t\tcontent = \'\'\n\t\tfor line in lines:\n\t\t\tcontent += line.strip()+" "\n\t\treg_vtt_2_gpt_list = []\n\t\treg_vtt_2_gpt_list.append([\n\t\t\tr\'(\\d{2}:\\d{2}:\\d{2}).\\d{3} --> \\d{1,2}:\\d{2}:\\d{2}.\\d{3}\', r\'\\n(\\1)\'])\n\t\treg_vtt_2_gpt_list.append([\n\t\t\tr\'WEBVTT Kind:.+ Language:.+\\n\', r\'\'])\n\t\treg_vtt_2_gpt_list.append([r\'&nbsp;\', r\' \'])\n\t\treg_vtt_2_gpt_list.append([r\' line:\\d{1,3}%\', r\' \'])\n\t\treg_vtt_2_gpt_list.append([r\'[ ]{1,}\', r\' \'])\n\t\tfor reg_vtt_2_gpt in reg_vtt_2_gpt_list:\n\t\t\tcontent = re.sub(reg_vtt_2_gpt[0], reg_vtt_2_gpt[1], content)\n\t\twith open(os.path.join(directory_path, file), "w", encoding="utf-8") as f1:\n\t\t\tf1.write(content)\n\tif files_srt != []:\n\t\tprint(files_srt)\n\t\tprompt_generator.video_summarization_expert_one(content)\ndef subtitles_format_for_gpt_input(directory_path=None):\n\tif directory_path is None:\n\t\tdirectory_path = os.getcwd()\n\tvtt_format_4_gpt(directory_path)\n\tsrt_format_4_gpt(directory_path)\ndef get_list_key_word_vid(current_dir=None):\n\tif current_dir is None:\n\t\tcurrent_dir = os.getcwd()\n\tlist_key_word_vid = []\n\tfiles_mp4 = [file for file in os.listdir(\n\t\tcurrent_dir) if file.endswith(".mp4")]\n\tfiles_mp4.sort()\n\tfor file in files_mp4:\n\t\treg = r".*? - Lecture \\d{1,2} - (.*?)-.*?\\.mp4"\n\t\tmatch = re.search(reg, file)\n\t\tif match:\n\t\t\tlist_key_word_vid.append(match[1])\n\t\telse:\n\t\t\tprint("not matching")\n\treturn list_key_word_vid\ndef mul_initialize_vid_note_file_structure(current_dir=None, list_content=None):\n\tflags = flags_utils.GlobalFlags()\n\tflags.set_flag(\'TR_MODE\', True)\n\tTR_MODE = flags.get_flag(\'TR_MODE\')\n\tif current_dir is None:\n\t\tcurrent_dir = os.getcwd()\n\tTopic, sub_topic1 = file_operations_utils.get_Topic_in_kg(TR_MODE)\n\tif Topic is None:\n\t\traise ValueError("Topic is None")\n\tbvids_origin_topic_path = file_operations_utils.get_bvids_origin_topic_path(\n\t\tTopic, TR_MODE)\n\tif list_content is None:\n\t\tlist_content = get_list_key_word_vid(\n\t\t\tcurrent_dir=bvids_origin_topic_path)\n\tfor content in list_content:\n\t\tinitialize_vid_note_file_structure(current_dir, content)\ndef initialize_vid_note_file_structure(current_dir=None, content=None):\n\tflags = flags_utils.GlobalFlags()\n\tflags.set_flag(\'TR_MODE\', True)\n\tTR_MODE = flags.get_flag(\'TR_MODE\')\n\t# Get content from clipboard\n\tif content is None:\n\t\tcontent = pyperclip.paste()\n\tcontent = content.strip()\n\treg_content_to_current_topic = [r"\\d{1,3}_(.+)\\.mp4", r"\\1"]\n\tmatch = re.search(reg_content_to_current_topic[0], content)\n\tif match:\n\t\tcurrent_topic = re.sub(\n\t\t\treg_content_to_current_topic[0], reg_content_to_current_topic[1], content)\n\telse:\n\t\treg_content_to_current_topic = [r"(.+)\\.mp4", r"\\1"]\n\t\tmatch = re.search(reg_content_to_current_topic[0], content)\n\t\tif match:\n\t\t\tcurrent_topic = re.sub(\n\t\t\t\treg_content_to_current_topic[0], reg_content_to_current_topic[1], content)\n\t\telse:\n\t\t\tcurrent_topic = content\n\tif TR_MODE == 1:\n\t\tprint("current_topic: ", current_topic)\n\tif current_dir is None:\n\t\tcurrent_dir = os.getcwd()\n\t# Check for existing serial numbers (first three digits of filenames)\n\tserial_numbers = [f[:3] for f in os.listdir(current_dir) if os.path.isfile(\n\t\tos.path.join(current_dir, f)) and f[:3].isdigit()]\n\t# # Generate filename\n\t# if serial_numbers:\n\t#\t max_serial_number = max(serial_numbers)\n\t#\t note_file = str(int(max_serial_number) + 1).zfill(3) + \\\n\t#\t\t "_"+current_topic+".md"\n\t# else:\n\t#\t note_file = "001"+"_"+current_topic+".md"\n\tmax_serial_number = max(serial_numbers) if serial_numbers else "000"\n\tnote_file = f"{int(max_serial_number) + 1:03d}_{current_topic}.md"\n\tif TR_MODE == 1:\n\t\tprint("note_file: ", note_file)\n\t# Add the filename to the current_dir\n\tnote_file_path = os.path.join(current_dir, note_file)\n\tif not os.path.exists(note_file_path):\n\t\twith open(note_file_path, \'w\') as f:\n\t\t\tf.write("")\n\tsub_topic1_to_sub_topicn_folder_list = [note_file[:-3]]\n\t# sub_topic1_to_sub_topicn_folder_list.append(os.path.basename(current_dir))\n\tnote_assets_dir_path = file_operations_utils.get_note_assets_dir_path(\n\t\tsub_topic1_to_sub_topicn_folder_list, current_dir)\n\tif TR_MODE == 1:\n\t\tprint("note_assets_dir_path: ", note_assets_dir_path)\n\tfile_operations_utils.create_file_subtitle_summary_gpt_md(\n\t\tnote_assets_dir_path)\n\tTopic, sub_topic1 = file_operations_utils.get_Topic_in_kg(TR_MODE)\n\tif Topic is None:\n\t\traise ValueError("Topic is None")\n\tbvids_origin_topic_path = file_operations_utils.get_bvids_origin_topic_path(\n\t\tTopic, TR_MODE)\n\tflag_search_sub_topic1 = flags_utils.get_flag_search_sub_topic1_in_bvids_origin_topic_path()\n\tif flag_search_sub_topic1:\n\t\tdirs = [d for d in os.listdir(bvids_origin_topic_path) if os.path.isdir(\n\t\t\tos.path.join(bvids_origin_topic_path, d))]\n\t\tif TR_MODE:\n\t\t\tprint("dirs:", dirs)\n\t\treg_string = r"\\d{1,3}_"+sub_topic1\n\t\tflag_find_sub_topic = False\n\t\tfor dir in dirs:\n\t\t\tif re.match(reg_string, dir):\n\t\t\t\tbvids_origin_topic_path = os.path.join(\n\t\t\t\t\tbvids_origin_topic_path, dir)\n\t\t\t\tflag_find_sub_topic = True\n\t\t\t\tbreak\n\t\tif not flag_find_sub_topic:\n\t\t\traise Exception("sub topic not found")\n\t# if match copy to des\n\tfiles_subtitle = [f for f in os.listdir(\n\t\tbvids_origin_topic_path) if f.endswith(\'.srt\') or f.endswith(\'.vtt\')]\n\tif TR_MODE:\n\t\tprint("files_subtitle:", files_subtitle)\n\treg_sub_string_current_topic = [\n\t\tr\'(\\d{1,3}_|)\'+current_topic+r\'(\\.en|\\.eng|\\.zh|\\.cn|\\.zho|\\.chi|\\.zh-Hans|\\.zh-Hant|)(\\.srt|\\.vtt)\', r\'\']\n\tflag_one_by_one = flags_utils.get_flag_one_by_one()\n\tfor file_srt in files_subtitle:\n\t\tmatch = re.match(reg_sub_string_current_topic[0], file_srt)\n\t\tflag_find_match = False\n\t\tif match:\n\t\t\tflag_find_match = True\n\t\t\tif ((match.group(2) == ".en") or (match.group(2) == "")):\n\t\t\t\t# copy srt to note_assets_dir_path\n\t\t\t\tnew_srt_name = note_file[:-3]+match.group(2)+match.group(3)\n\t\t\t\tsrc_srt_file_path = os.path.join(\n\t\t\t\t\tbvids_origin_topic_path, file_srt)\n\t\t\t\tdes_srt_file_path = os.path.join(\n\t\t\t\t\tnote_assets_dir_path, new_srt_name)\n\t\t\t\tshutil.copy(src_srt_file_path, des_srt_file_path)\n\tif not flag_find_match:\n\t\tif flag_one_by_one:\n\t\t\tfile_srt = files_subtitle[0]\n\t\t\tsrc_srt_file_path = os.path.join(\n\t\t\t\tbvids_origin_topic_path, file_srt)\n\t\t\tdes_srt_file_path = os.path.join(\n\t\t\t\tnote_assets_dir_path, file_srt)\n\t\t\tshutil.copy(src_srt_file_path, des_srt_file_path)\n\tsubtitles_format_for_gpt_input(note_assets_dir_path)\n\t# todo generate prompt\ndef move_origin_vid_to_destination(TR_MODE=0):\n\tflag_one_by_one = flags_utils.get_flag_one_by_one()\n\tif TR_MODE:\n\t\tprint("flag_one_by_one:", flag_one_by_one)\n\tflag_search_sub_topic1 = flags_utils.get_flag_search_sub_topic1_in_bvids_origin_topic_path()\n\tkey_word, key_word_path = file_operations_utils.get_kg_bassets_folder_keyword()\n\tsub_topic1_to_sub_topicn_folder_list, OneDrive_KG_note_root_directory_path = file_operations_utils.get_bassets_keyword_path(\n\t\tkey_word=key_word)\n\t# sub_topic1_to_sub_topicn_folder_list, OneDrive_KG_note_root_directory_path = get_bassets_keyword_path(key_word="NN_1687967434")\n\torigin_current_vid_file_name = ""\n\t# sub_topic1_to_sub_topicn_folder_list, OneDrive_KG_note_root_directory_path = get_kg_assets_root()\n\tTopic, sub_topic1, current_topic = file_operations_utils.get_Topic_in_kg_assets(\n\t\tTR_MODE)\n\tif TR_MODE:\n\t\tprint("Folder list:", sub_topic1_to_sub_topicn_folder_list)\n\t\tprint("OneDrive KG root directory_path:",\n\t\t\t  OneDrive_KG_note_root_directory_path)\n\tBaiduSyncdisk_KG_note_root_directory_path = file_operations_utils.get_b_KG_directory_path(\n\t\tOneDrive_KG_note_root_directory_path)\n\tif TR_MODE:\n\t\tprint("BaiduSyncdisk assets root _directory_path:",\n\t\t\t  BaiduSyncdisk_KG_note_root_directory_path)\n\tbvids_origin_topic_path = file_operations_utils.get_bvids_origin_topic_path(\n\t\tTopic, TR_MODE=TR_MODE)\n\tif flag_search_sub_topic1:\n\t\tdirs = [d for d in os.listdir(bvids_origin_topic_path) if os.path.isdir(\n\t\t\tos.path.join(bvids_origin_topic_path, d))]\n\t\tif TR_MODE:\n\t\t\tprint("dirs:", dirs)\n\t\treg_string = r"\\d{1,3}_"+sub_topic1\n\t\tflag_find_sub_topic = False\n\t\tfor dir in dirs:\n\t\t\tif re.match(reg_string, dir):\n\t\t\t\tbvids_origin_topic_path = os.path.join(\n\t\t\t\t\tbvids_origin_topic_path, dir)\n\t\t\t\tflag_find_sub_topic = True\n\t\t\t\tbreak\n\t\tif not flag_find_sub_topic:\n\t\t\traise Exception("sub topic not found")\n\tfiles = [f for f in os.listdir(bvids_origin_topic_path) if os.path.isfile(\n\t\tos.path.join(bvids_origin_topic_path, f)) and f.endswith(".mp4")]\n\tfiles.sort()\n\tif TR_MODE:\n\t\tprint("Files:", files)\n\tOneDrive_KG_current_note_directory_path = file_operations_utils.get_OneDrive_KG_note_path(\n\t\tOneDrive_KG_note_root_directory_path, sub_topic1_to_sub_topicn_folder_list)\n\tif TR_MODE:\n\t\tprint("OneDrive KG note directory_path:",\n\t\t\t  OneDrive_KG_current_note_directory_path)\n\tcurrent_bvid_name = file_operations_utils.get_current_bvid_name()\n\tif TR_MODE:\n\t\tprint("current_bvid_name:", current_bvid_name)\n\tserial_number = current_bvid_name[:3]\n\tif TR_MODE:\n\t\tprint("serial_number:", serial_number)\n\tbvids_destination_directory_path = file_operations_utils.get_bvids_destination_long(\n\t\tsub_topic1_to_sub_topicn_folder_list, BaiduSyncdisk_KG_note_root_directory_path)\n\tif TR_MODE:\n\t\tprint("bvids_destination_directory_path:",\n\t\t\t  bvids_destination_directory_path)\n\t# bvid_reg_string = r\'.+\\(P\\d{1,3}\\. \\d{1,3}\\.\\d{1,3}\\.\\d{1,3}(.+)\\)\\.mp4\'\n\tcurrent_bvid_destination_file_path = os.path.join(\n\t\tbvids_destination_directory_path, current_bvid_name)\n\tif flag_one_by_one:\n\t\tif not os.path.exists(current_bvid_destination_file_path):\n\t\t\tvid_name_origin = files[0]\n\t\t# origin_current_vid_file_name = "\\n"+re.sub(bvid_reg_string, r\'\\1\', vid_name_origin)\n\t\t\torigin_current_vid_file_name = vid_name_origin\n\t\t\tos.rename(os.path.join(bvids_origin_topic_path,\n\t\t\t\t\t  vid_name_origin), current_bvid_destination_file_path)\n\t\t\treg_vid_name_origin_serial = r"(\\d{2,6})_.+(\\.mp4|\\.flv|\\.whem)"\n\t\t\tmatch = re.search(reg_vid_name_origin_serial,\n\t\t\t\t\t\t\t  origin_current_vid_file_name)\n\t\t\tserial_number_origin = match.group(1)\n\t\t\tif match:\n\t\t\t\treg_string_sub = r"^" + \\\n\t\t\t\t\tserial_number_origin+"_"+".+?" + \\\n\t\t\t\t\tr"(\\.ch\\.cn|\\.en)(\\.srt|\\.vtt)$"\n\t\t\t\treg_string_sub2 = r"^" + \\\n\t\t\t\t\tserial_number_origin+"_"+".+?" + \\\n\t\t\t\t\tr"(\\.srt|\\.vtt)$"\n\t\t\telse:\n\t\t\t\traise Exception("Error: regex not match")\n\t\t\tfiles_sub = [f for f in os.listdir(bvids_origin_topic_path) if os.path.isfile(\n\t\t\t\tos.path.join(bvids_origin_topic_path, f)) and (f.endswith(".srt") or f.endswith(".vtt"))]\n\t\t\tfor file_sub in files_sub:\n\t\t\t\tmatch = re.search(reg_string_sub, file_sub)\n\t\t\t\tif match:\n\t\t\t\t\t# print(match)\n\t\t\t\t\tcurrent_bsrt_name = current_bvid_name[:-4] + \\\n\t\t\t\t\t\tmatch.group(1)+match.group(2)\n\t\t\t\t\tos.rename(os.path.join(\n\t\t\t\t\t\tbvids_origin_topic_path, file_sub), os.path.join(bvids_destination_directory_path, current_bsrt_name))\n\t\t\t\telse:\n\t\t\t\t\tmatch = re.search(reg_string_sub2, file_sub)\n\t\t\t\t\tif match:\n\t\t\t\t\t\tcurrent_bsrt_name = current_bvid_name[:-4] + \\\n\t\t\t\t\t\t\tmatch.group(1)\n\t\t\t\t\t\tos.rename(os.path.join(\n\t\t\t\t\t\t\tbvids_origin_topic_path, file_sub), os.path.join(bvids_destination_directory_path, current_bsrt_name))\n\treturn origin_current_vid_file_name, current_bvid_destination_file_path, OneDrive_KG_current_note_directory_path\ndef vid_path_2_md_vid_link(vid_path, current_bvid_name):\n\timport urllib\n\turl_path = urllib.parse.quote(os.path.abspath(vid_path))\n\turl = "file:///" + url_path.replace("\\\\", "/")\n\tmd_show_url = f"![{current_bvid_name}]({url})"\n\tmd_url = f"[{current_bvid_name}]({url})"\n\treturn md_show_url, md_url\ndef convert_chatgpt_summary_text_to_one_line_summary(directory_path=None):\n\tif directory_path is None:\n\t\tdirectory_path = os.getcwd()\n\tfiles_md = [f for f in os.listdir(directory_path) if f.endswith(\'.md\')]\n\treg_string_list = []\n\treg_string1 = [\n\t\tr\'(Section \\d{1,2}: |Title: |Title:\\n)(.+)\\n{1,2}(Start: |Start Timestamp: |Start Timestamp:\\n)(|\\()(\\d{1,2}:\\d{1,2})(|\\))\\n{1,2}Summary(: |:\\n)(.+)\', r"- \\2 (\\5) \\8"]\n\treg_string_list.append(reg_string1)\n\tfile_operations_utils.perform_regex_replacement_on_files(\n\t\treg_string_list, directory_path, files_md)\ndef check_video_file_path_conforms_to_pattern(str_url):\n\tr"![001_Derivatives of multivariable functions.mp4](file:///C%3A%5CBaiduSyncdisk%5Cassets%5CO%5CO1%5CO17%5CO172%5CMultivaribale_calculus_Khan_Academy%5Cassets%5Cbvids%5Cmc_1683793602%5C002%5C001%5C001_Derivatives%20of%20multivariable%20functions.mp4)"\n\turl_pattern_4_file_vid = r\'(!\\[.+\\..+\\]\\(file:///C:%5CBaiduSyncdisk%5Cassets(%5C.+){1,}\\.\\w+)(\\))\'\n\turl_pattern_4_file_vid2 = r\'(!\\[.+\\..+\\]\\(file:///C%3A%5CBaiduSyncdisk%5Cassets(%5C.+){1,}\\.\\w+)(\\))\'\n\tmatch1 = re.search(url_pattern_4_file_vid, str_url)\n\tif not match1:\n\t\tmatch1 = re.search(url_pattern_4_file_vid2, str_url)\n\t\tif not match1:\n\t\t\tprint("str_url: ", str_url)\n\t\t\traise Exception(\'No match found\')\n\treturn match1\ndef convert_min_sec_to_seconds(time_str):\n\ttime_line_pattern_str = r\'\\((\\d{1,2}:\\d{1,2})-(\\d{1,2}:\\d{1,2})\\)[ ]{1,}\'\n\ttime_stamp_pattern_str = r\'((\\d{1,2}):|)(\\d{1,2}):(\\d{1,2})\'\n\tmatch = re.search(time_line_pattern_str, time_str)\n\tif match:\n\t\ttime_line_start = match.group(1)\n\t\ttime_line_end = match.group(2)\n\t\ttime_line_start_seconds = int(time_line_start.split(\n\t\t\t\':\')[0])*60+int(time_line_start.split(\':\')[1])\n\t\treturn time_line_start_seconds\n\telse:\n\t\tmatch = re.search(time_stamp_pattern_str, time_str)\n\t\tif match:\n\t\t\tif match.group(2) != None:\n\t\t\t\t# print(match.group(1))\n\t\t\t\thour = int(match.group(2))\n\t\t\telse:\n\t\t\t\thour = 0\n\t\t\ttime_seconds = hour * 60*60 + \\\n\t\t\t\tint(match.group(3))*60 + int(match.group(4))\n\t\t\treturn time_seconds\n\t\telse:\n\t\t\treturn None\ndef get_list_time_head_textshort_text_4_file(file, key_word):\n\t# print("start to generate time line for video and head text:")\n\tnumber_list_head_time_text_pattern_str = r\'((\\d{1,2}\\.)|-)[ ]{1,}(.+) \\((\\d{1,2}):(\\d{1,2})\\) (.+)\'\n\tnumber_list_head_time_pattern_str = r\'(\\d{1,2}):(\\d{1,2}) - (.+)\'\n\tnumber_list_head_time_pattern_str2 = r\'(\\d{1,2}):(\\d{1,2}) (.+)\'\n\ttime_text_pattern_str = r\'\\((\\d{1,2}):(\\d{1,2})\\)[ ]{0,}([^\\n]+)[\\n]{0,}\'\n\tpattern_dict = dict()\n\tpattern_dict["timestamps"] = number_list_head_time_pattern_str\n\tpattern_dict["summary_gpt"] = number_list_head_time_text_pattern_str\n\tpattern_dict["subtitle"] = time_text_pattern_str\n\tlist_time_head_textshort_text = []\n\twith open(os.path.join(os.getcwd(), file), \'r\', encoding=\'UTF-8\') as f:\n\t\tlines = f.readlines()\n\tfor line in lines:\n\t\ttime_line_start_seconds = convert_min_sec_to_seconds(line)\n\t\tif time_line_start_seconds != None:\n\t\t\tif key_word in pattern_dict:\n\t\t\t\tpattern_str = pattern_dict[key_word]\n\t\t\t\tmatch = re.search(pattern_str, line)\n\t\t\t\tif match:\n\t\t\t\t\tif key_word == "timestamps":\n\t\t\t\t\t\tlist_time_head_textshort_text.append(\n\t\t\t\t\t\t\t[time_line_start_seconds, match.group(3), None, None])\n\t\t\t\t\telif key_word == "summary_gpt":\n\t\t\t\t\t\t# for i in range(len(match.groups())):\n\t\t\t\t\t\t#\t print(i,match.group(i))\n\t\t\t\t\t\tlist_time_head_textshort_text.append(\n\t\t\t\t\t\t\t[time_line_start_seconds, match.group(3), match.group(6), None])\n\t\t\t\t\telif key_word == "subtitle":\n\t\t\t\t\t\tlist_time_head_textshort_text.append(\n\t\t\t\t\t\t\t[time_line_start_seconds, None, None, match.group(3)])\n\t\t\t\telse:\n\t\t\t\t\tif key_word == "timestamps":\n\t\t\t\t\t\tmatch2 = re.search(\n\t\t\t\t\t\t\tnumber_list_head_time_pattern_str2, line)\n\t\t\t\t\t\tif match2:\n\t\t\t\t\t\t\tlist_time_head_textshort_text.append(\n\t\t\t\t\t\t\t\t[time_line_start_seconds, match2.group(3), None, None])\n\t\t\t\t\t\telse:\n\t\t\t\t\t\t\tprint("no match for line:", line)\n\t\t\t\t\t\t\tprint(key_word)\n\t\t\t\t\telse:\n\t\t\t\t\t\tprint("no match for line:", line)\n\t\t\t\t\t\tprint(key_word)\n\t\t\telse:\n\t\t\t\traise Exception("key_word not in pattern_dict")\n\t# print("List of time, heading, short text, text:")\n\t# print(list_time_head_textshort_text)\n\treturn list_time_head_textshort_text\ndef list_time_head_textshort_text_to_vid_timeline_md(timeline_data, file, match):\n\t# print(timeline_data)\n\tassets_root_path, assets_root_dir = file_operations_utils.get_assets_root_path()\n\toutput_dir = file_operations_utils.create_output_directory(\n\t\tassets_root_path)\n\tnew_file_name = file_operations_utils.create_new_file_name(file)\n\tflag_write_line_by_line = True\n\tif not flag_write_line_by_line:\n\t\tcontent = ""\n\twith open(os.path.join(output_dir, new_file_name), \'w\', encoding=\'UTF-8\') as f:\n\t\tfor i, (start_time, heading, short_text, text) in enumerate(timeline_data):\n\t\t\tstart_time_sec = int(start_time)\n\t\t\tif i == len(timeline_data) - 1:\n\t\t\t\tend_time_sec = start_time_sec + 999\n\t\t\telse:\n\t\t\t\tend_time_sec = int(timeline_data[i + 1][0])\n\t\t\tif heading:\n\t\t\t\tif flag_write_line_by_line:\n\t\t\t\t\tf.write(f"## {heading}\\n\\n")\n\t\t\t\telse:\n\t\t\t\t\tcontent += f"## {heading}\\n\\n"\n\t\t\t\ti_temp = i\n\t\t\t\tflag_find_next_head = False\n\t\t\t\twhile i_temp < len(timeline_data) - 1:\n\t\t\t\t\ti_temp += 1\n\t\t\t\t\tif timeline_data[i_temp][1]:\n\t\t\t\t\t\tend_time_sec2 = int(timeline_data[i_temp][0])\n\t\t\t\t\t\tvid_line = f"{match.group(1)}#t={start_time_sec},{end_time_sec2}{match.group(3)}"\n\t\t\t\t\t\tif flag_write_line_by_line:\n\t\t\t\t\t\t\tf.write(f"{vid_line}\\n\\n")\n\t\t\t\t\t\telse:\n\t\t\t\t\t\t\tcontent += f"{vid_line}\\n\\n"\n\t\t\t\t\t\tflag_find_next_head = True\n\t\t\t\t\t\tbreak\n\t\t\t\tif not flag_find_next_head:\n\t\t\t\t\tvid_line = f"{match.group(1)}#t={start_time_sec}{match.group(3)}"\n\t\t\t\t\tif flag_write_line_by_line:\n\t\t\t\t\t\tf.write(f"{vid_line}\\n\\n")\n\t\t\t\t\telse:\n\t\t\t\t\t\tcontent += f"{vid_line}\\n\\n"\n\t\t\tif short_text:\n\t\t\t\tif flag_write_line_by_line:\n\t\t\t\t\tf.write(f"- {short_text}\\n\\n")\n\t\t\t\telse:\n\t\t\t\t\tcontent += f"- {short_text}\\n\\n"\n\t\t\tif heading:\n\t\t\t\tif flag_write_line_by_line:\n\t\t\t\t\tf.write(f"---\\n\\n\\n\\n")\n\t\t\t\telse:\n\t\t\t\t\tcontent += f"---\\n\\n\\n\\n"\n\t\t\tif text:\n\t\t\t\tvid_line = f"{match.group(1)}#t={start_time_sec},{end_time_sec}{match.group(3)}"\n\t\t\t\tif flag_write_line_by_line:\n\t\t\t\t\tf.write(f"{vid_line}\\n\\n")\n\t\t\t\t\tf.write(f"{text}\\n\\n")\n\t\t\t\telse:\n\t\t\t\t\tcontent += f"{vid_line}\\n\\n"\n\t\t\t\t\tcontent += f"{text}\\n\\n"\n\t\t\tif flag_write_line_by_line:\n\t\t\t\tpass\n\t\t\telse:\n\t\t\t\tf.write(content)\n\t\t\t\tcontent = ""\n\treturn output_dir, new_file_name\ndef convert_md_vid_link_to_html(directory_path=None):\n\tif directory_path is None:\n\t\tdirectory_path = os.getcwd()\n\tfiles_md = [f for f in os.listdir(directory_path) if f.endswith(\'.md\')]\n\treg_string_list = []\n\treg_string2 = [r\'(!\\[\\]|!\\[.+\\])\\((file:///.+(\\.mp4|\\.mp4#t=.+))\\)\',\n\t\t\t\t   r\'<video src="\\2" controls></video>\']\n\treg_string_list.extend([reg_string2])\n\tfile_operations_utils.perform_regex_replacement_on_files(\n\t\treg_string_list, directory_path, files_md)\ndef convert_md_vid_link_to_html_tree(directory_path=None):\n\tif directory_path is None:\n\t\tdirectory_path = os.getcwd()\n\treg_string_list = []\n\treg_string2 = [r\'(!\\[\\]|!\\[.+\\])\\((file:///.+(\\.mp4|\\.mp4#t=.+))\\)\',\n\t\t\t\t   r\'<video src="\\2" controls></video>\']\n\treg_string_list.extend([reg_string2])\n\tfile_operations_utils.perform_regex_replacement_on_files_tree(\n\t\treg_string_list, directory_path)\ndef convert_gpt_summary_to_markdown_vid_timeline(str_url, TR_MODE, path=None):\n\t# str_url=r\'![009_area-and-slope.mp4](file:///C:%5CBaiduSyncdisk%5Cassets%5CO%5CO1%5CO17%5CO172%5CCalculus%203Blue1Brown%5Cassets%5Cbvids%5C009_area-and-slope.mp4)\'\n\tmatch1 = check_video_file_path_conforms_to_pattern(str_url)\n\tif path is None:\n\t\tpath = os.getcwd()\n\tfile_list = os.listdir(path)\n\tassets_root_path, assets_root_dir = file_operations_utils.get_assets_root_path()\n\tif TR_MODE:\n\t\tprint("assets_root_path is : ", assets_root_path)\n\toutput_dir = file_operations_utils.create_output_directory(\n\t\tassets_root_path)\n\tif TR_MODE:\n\t\tprint("output_dir is : ", output_dir)\n\tfor file in file_list:\n\t\tif file.endswith(".md"):\n\t\t\tif file.find("summary_gpt") != -1:\n\t\t\t\tcwd_floder_name = os.path.basename(path)\n\t\t\t\tfile_summary = file\n\t\t\t\tkey_word = "summary_gpt"\n\t\t\t\tlist_time_head_textshort = get_list_time_head_textshort_text_4_file(\n\t\t\t\t\tfile, key_word)\n\t\t\t\t# list_time_head_textshort_text_to_vid_timeline_md(list_time_head_textshort_text,file,match1)\n\tif TR_MODE:\n\t\tprint("list_time_head_textshort is :", list_time_head_textshort)\n\tlist_time_head_textshort_text_to_vid_timeline_md(\n\t\tlist_time_head_textshort, file_summary, match1)\n\tconvert_md_vid_link_to_html(output_dir)\n\treturn output_dir, file_summary\ndef get_note_vid_name():\n\tfile = os.path.basename(os.getcwd())\n\treturn file+r\'_vid\'+".md"\ndef merge_all_content_into_md_note_file(note_name, file_summary_path, origin_current_vid_file_name, current_vid_md_link_content, OneDrive_KG_current_note_directory_path):\n\twith open(os.path.join(OneDrive_KG_current_note_directory_path, note_name), "r", encoding="utf-8") as f:\n\t\tcurrent_note_origin_content = f.read()\n\twith open(file_summary_path, "r", encoding="utf-8") as f:\n\t\tcurrent_vid_summary = f.read()\n\twith open(os.path.join(OneDrive_KG_current_note_directory_path, note_name), "w", encoding="utf-8") as f:\n\t\tf.write(current_note_origin_content+origin_current_vid_file_name +\n\t\t\t\tcurrent_vid_md_link_content+current_vid_summary)\ndef generate_vid_note_with_timeline_from_text_summary():\n\tTR_MODE = 1\n\torigin_current_vid_file_name, current_bvid_destination_file_path, OneDrive_KG_current_note_directory_path = move_origin_vid_to_destination(\n\t\tTR_MODE)\n\tcurrent_bvid_name = file_operations_utils.get_current_bvid_name()\n\tif TR_MODE:\n\t\tprint("current_bvid_name:", current_bvid_name)\n\tmd_show_url, md_url = vid_path_2_md_vid_link(\n\t\tcurrent_bvid_destination_file_path, current_bvid_name)\n\tcurrent_vid_md_link_content = \'\\n\\n\'+md_url+\'\\n\'+md_show_url+\'\\n\\n\'\n\tif TR_MODE:\n\t\tprint("md_show_url:", md_show_url)\n\t\tprint("md_url:", md_url)\n\tconvert_chatgpt_summary_text_to_one_line_summary()\n\t# output_dir, file_summary = convert_subtitle_and_summary_to_markdown_vid_timeline(\n\t#\t md_show_url)\n\toutput_dir, file_summary = convert_gpt_summary_to_markdown_vid_timeline(\n\t\tmd_show_url, TR_MODE)\n\tfile_summary_path = os.path.join(output_dir, file_summary)\n\tnote_name = get_note_vid_name()\n\tif TR_MODE:\n\t\tprint("note_name:", note_name)\n\tif not os.path.exists(os.path.join(OneDrive_KG_current_note_directory_path, note_name)):\n\t\t# print(os.path.join(OneDrive_KG_current_note_directory_path, note_name),"is note exists")\n\t\t# raise Exception("note not found")\n\t\twith open(os.path.join(OneDrive_KG_current_note_directory_path, note_name), "w", encoding="utf-8") as f:\n\t\t\tpass\n\tmerge_all_content_into_md_note_file(note_name, file_summary_path, origin_current_vid_file_name,\n\t\t\t\t\t\t\t\t\t\tcurrent_vid_md_link_content, OneDrive_KG_current_note_directory_path)\n\tconvert_md_vid_link_to_html(OneDrive_KG_current_note_directory_path)\ndef timestamps_3blue1brown_2_timeline(str_url):\n\t# process url\n\t# str_url=r\'![007_limits.mp4](file:///C:%5CBaiduSyncdisk%5Cassets%5CO%5CO1%5CO17%5CO172%5CCalculus%203Blue1Brown%5Cassets%5Cbvids%5C007_limits.mp4)\'\n\t# \'(!\\[.+\\..+\\]\\(file:///C:%5CBaiduSyncdisk%5Cassets(%5C.+){1,}\\.\\w+)(\\))\'\n\tmatch1 = check_video_file_path_conforms_to_pattern(str_url)\n\t# timestamps file\n\tfile_list = os.listdir(os.getcwd())\n\tfor file in file_list:\n\t\tif file.endswith(".md") or file.endswith(".txt"):\n\t\t\tif file.find("timestamps") != -1:\n\t\t\t\tkey_word = "timestamps"\n\t\t\t\tlist_time_head_textshort_text = get_list_time_head_textshort_text_4_file(\n\t\t\t\t\tfile, key_word)\n\t\t\t\toutput_dir, file_name = list_time_head_textshort_text_to_vid_timeline_md(\n\t\t\t\t\tlist_time_head_textshort_text, file, match1)\n\t\t\t\treturn output_dir, file_name\ndef generate_vid_note_with_timeline_from_timestamps():\n\tTR_MODE = 1\n\torigin_current_vid_file_name, current_bvid_destination_file_path, OneDrive_KG_current_note_directory_path = move_origin_vid_to_destination(\n\t\tTR_MODE)\n\tcurrent_bvid_name = file_operations_utils.get_current_bvid_name(\n\t\tcurrent_bvid_destination_file_path)\n\tmd_show_url, md_url = vid_path_2_md_vid_link(\n\t\tcurrent_bvid_destination_file_path, current_bvid_name)\n\tcurrent_vid_md_link_content = \'\\n\\n\'+md_url+\'\\n\'+md_show_url+\'\\n\\n\'\n\tif TR_MODE:\n\t\tprint("md_show_url:", md_show_url)\n\t\tprint("md_url:", md_url)\n\toutput_dir, file_summary = timestamps_3blue1brown_2_timeline(md_show_url)\n\tfile_summary_path = os.path.join(output_dir, file_summary)\n\tnote_name = get_note_vid_name()\n\tif TR_MODE:\n\t\tprint("note_name:", note_name)\n\tif not os.path.exists(os.path.join(OneDrive_KG_current_note_directory_path, note_name)):\n\t\t# print(os.path.join(OneDrive_KG_current_note_directory_path, note_name),"is note exists")\n\t\t# raise Exception("note not found")\n\t\twith open(os.path.join(OneDrive_KG_current_note_directory_path, note_name), "w", encoding="utf-8") as f:\n\t\t\tpass\n\tmerge_all_content_into_md_note_file(note_name, file_summary_path, origin_current_vid_file_name,\n\t\t\t\t\t\t\t\t\t\tcurrent_vid_md_link_content, OneDrive_KG_current_note_directory_path)\n\tconvert_md_vid_link_to_html(OneDrive_KG_current_note_directory_path)\ndef merge_list_time_head_textshort_text(list_time_text, list_time_head_textshort):\n\t# print("list_time_head_textshort is :")\n\t# print(list_time_head_textshort)\n\t# print("list_time_text is :")\n\t# print(list_time_text)\n\tfor i in range(len(list_time_head_textshort)):\n\t\t# print(list_time_head_textshort[i][0])\n\t\tfor j in range(len(list_time_text)):\n\t\t\tif list_time_head_textshort[i][0] == list_time_text[j][0]:\n\t\t\t\ttime_text = list_time_text.pop(j)\n\t\t\t\tprint(time_text)\n\t\t\t\tlist_time_head_textshort[i][3] = time_text[3]\n\t\t\t\t# list_time_head_textshort.append([list_time_head_textshort[i][0],list_time_head_textshort[i][1],list_time_head_textshort[i][2],time_text[3]])\n\t\t\t\tbreak\n\t# print("first merge list_time_head_textshort_text is :")\n\t# print(list_time_head_textshort)\n\tlist_time_head_textshort_text = list_time_head_textshort\n\tif len(list_time_text) > 0:\n\t\t# print("remain:",list_time_text)\n\t\tlist_pop = []\n\t\tfor i in range(len(list_time_text)):\n\t\t\tfor j in range(len(list_time_head_textshort_text)):\n\t\t\t\ttime_text = int(list_time_text[i][0])\n\t\t\t\ttime_shorttext = int(list_time_head_textshort_text[j][0])\n\t\t\t\tif j != len(list_time_head_textshort_text)-1:\n\t\t\t\t\ttime_shorttext_next = int(\n\t\t\t\t\t\tlist_time_head_textshort_text[j+1][0])\n\t\t\t\t\tif time_text > time_shorttext and time_text < time_shorttext_next:\n\t\t\t\t\t\tlist_time_head_textshort_text.insert(\n\t\t\t\t\t\t\tj+1, [list_time_text[i][0], None, None, list_time_text[i][3]])\n\t\t\t\t\t\tlist_pop.append(list_time_text[i])\n\t\t\t\t\t\tbreak\n\t\t\t\telse:\n\t\t\t\t\tif time_text > time_shorttext:\n\t\t\t\t\t\tlist_time_head_textshort_text.append(\n\t\t\t\t\t\t\t[list_time_text[i][0], None, None, list_time_text[i][3]])\n\t\t\t\t\t\tlist_pop.append(list_time_text[i])\n\t\t\t\t\t\tbreak\n\t\tfor elment in list_pop:\n\t\t\tindex = list_time_text.index(elment)\n\t\t\tlist_time_text.pop(index)\n\tif len(list_time_text) > 0:\n\t\tprint("remain:", list_time_text)\n\treturn list_time_head_textshort_text\ndef get_bvid_reg_string(sub_topic1_to_sub_topicn_folder_list, TR_MODE=0):\n\t# sub_topic=sub_topic1_to_sub_topicn_folder_list[-2].split("_")[-2]+" "+sub_topic1_to_sub_topicn_folder_list[-2].split("_")[-1]\n\t# sub_topic=sub_topic1_to_sub_topicn_folder_list[-2].split("_")[-1]\n\treg_sub = [r\'\\d{3}_(.+)\', r\'\\1\']\n\tmatch = re.search(reg_sub[0], sub_topic1_to_sub_topicn_folder_list[-2])\n\tif match:\n\t\tsub_topic1 = re.sub(reg_sub[0], reg_sub[1],\n\t\t\t\t\t\t\tsub_topic1_to_sub_topicn_folder_list[-2])\n\t\tsub_topic1.replace("_", " ")\n\telse:\n\t\traise Exception("sub_topic1 not found")\n\tif TR_MODE:\n\t\tprint("Sub topic1:", sub_topic1)\n\tcurrent_topic = sub_topic1_to_sub_topicn_folder_list[-1].split("_")[-1]\n\tif TR_MODE:\n\t\tprint("Current topic:", current_topic)\n\tbvid_reg_string = current_topic+r\'(( - )|(- - ))\'+sub_topic1+r\'\\.mp4\'\n\tif TR_MODE:\n\t\tprint("bvid_reg_string:", bvid_reg_string)\n\tbvid_srt_reg_string = current_topic + \\\n\t\tr\'(( - )|(- - ))\'+sub_topic1+r\'(\\.en|\\.en.+)\'+r\'\\.srt\'\n\treturn bvid_reg_string, bvid_srt_reg_string\ndef get_bvids_destination_short(sub_topic1_to_sub_topicn_folder_list, BaiduSyncdisk_assets_root):\n\tpath_temp = BaiduSyncdisk_assets_root\n\tfor i in range(len(sub_topic1_to_sub_topicn_folder_list)-1):\n\t\tfolder_temp = sub_topic1_to_sub_topicn_folder_list[i].split(\'_\')[0]\n\t\tif folder_temp != "FPCV":\n\t\t\tpath_temp = os.path.join(path_temp, folder_temp)\n\t\telse:\n\t\t\tpath_temp = os.path.join(\n\t\t\t\tpath_temp, sub_topic1_to_sub_topicn_folder_list[i])\n\t\tif not os.path.exists(path_temp):\n\t\t\tos.makedirs(path_temp)\n\treturn path_temp\ndef get_bvids_origin_topic_path(BaiduSyncdisk_assets_root):\n\treturn os.path.join(BaiduSyncdisk_assets_root, "assets", "bvids", "mc_1683793602")\ndef get_note_name():\n\tfile = os.path.basename(os.getcwd())\n\treturn file+".md"\ndef get_note_vid_tra_name():\n\tfile = os.path.basename(os.getcwd())\n\treturn file+r\'_vid_tra\'+".md"\ndef copy_timestamps_and_index_2_root(directory=None):\n\t"""\n\tCopies files with \'timestamps\' in their name and \'.mdx\' extension to the root directory\n\twith an updated name. Also copies files with \'index\' in their name and \'.mdx\' extension\n\tto the root directory with an updated name.\n\t"""\n\tif directory is None:\n\t\tdirectory = os.getcwd()\n\tcurrent_folder_name = os.path.basename(directory)\n\tfilelist = os.listdir(directory)\n\tfor file in filelist:\n\t\tfile_name, file_extension = os.path.splitext(file)\n\t\tif "timestamps" in file_name and file_extension == \'.md\':\n\t\t\tnew_file_name1 = f"timestamps_{current_folder_name}.md"\n\t\t\tdest_path1 = os.path.join(directory, \'../..\', new_file_name1)\n\t\t\tif not os.path.exists(dest_path1):\n\t\t\t\tshutil.copy(file, dest_path1)\n\t\tif file_extension == \'.mdx\':\n\t\t\tif "index" in file_name:\n\t\t\t\tnew_file_name = f"{current_folder_name}.md"\n\t\t\t\tdest_path = os.path.join(directory, \'../..\', new_file_name)\n\t\t\t\tif not os.path.exists(dest_path):\n\t\t\t\t\tshutil.copy(file, dest_path)\ndef convert_subtitle_and_summary_to_markdown_vid_timeline(str_url):\n\t# str_url=r\'![009_area-and-slope.mp4](file:///C:%5CBaiduSyncdisk%5Cassets%5CO%5CO1%5CO17%5CO172%5CCalculus%203Blue1Brown%5Cassets%5Cbvids%5C009_area-and-slope.mp4)\'\n\tmatch1 = check_video_file_path_conforms_to_pattern(str_url)\n\tcwd = os.getcwd()\n\tfile_list = os.listdir(cwd)\n\tassets_root_path, assets_root_dir = get_assets_root_path()\n\toutput_dir = create_output_directory(assets_root_path)\n\tfor file in file_list:\n\t\tif file.endswith(".md"):\n\t\t\tif file.find("subtitle") != -1:\n\t\t\t\tkey_word = "subtitle"\n\t\t\t\tlist_time_text = get_list_time_head_textshort_text_4_file(\n\t\t\t\t\tfile, key_word)\n\t\t\t\t# list_time_head_textshort_text_to_vid_timeline_md(list_time_head_textshort_text,file,match1)\n\t\t\tif file.find("summary_gpt") != -1:\n\t\t\t\tcwd_floder_name = os.path.basename(cwd)\n\t\t\t\tfile_summary = file\n\t\t\t\tkey_word = "summary_gpt"\n\t\t\t\tlist_time_head_textshort = get_list_time_head_textshort_text_4_file(\n\t\t\t\t\tfile, key_word)\n\t\t\t\t# list_time_head_textshort_text_to_vid_timeline_md(list_time_head_textshort_text,file,match1)\n\tlist_time_head_textshort_text = merge_list_time_head_textshort_text(\n\t\tlist_time_text, list_time_head_textshort)\n\tprint("final is:")\n\tprint(list_time_head_textshort_text)\n\tlist_time_head_textshort_text_to_vid_timeline_md(\n\t\tlist_time_head_textshort_text, file_summary, match1)\n\tconvert_md_vid_link_to_html(output_dir)\n\treturn output_dir, file_summary\ndef convert_subtitle_chatgpt_summary_to_markdown_vid_timeline(str_url):\n\t# str_url=r\'![009_area-and-slope.mp4](file:///C:%5CBaiduSyncdisk%5Cassets%5CO%5CO1%5CO17%5CO172%5CCalculus%203Blue1Brown%5Cassets%5Cbvids%5C009_area-and-slope.mp4)\'\n\tmatch1 = check_video_file_path_conforms_to_pattern(str_url)\n\tcwd = os.getcwd()\n\tfile_list = os.listdir(cwd)\n\tassets_root_path, assets_root_dir = get_assets_root_path()\n\tcreate_output_directory(assets_root_path)\n\tfor file in file_list:\n\t\tif file.endswith(".md"):\n\t\t\tif file.find("summary_gpt") != -1:\n\t\t\t\tkey_word = "summary_gpt"\n\t\t\t\tlist_time_head_textshort_text = get_list_time_head_textshort_text_4_file(\n\t\t\t\t\tfile, key_word)\n\t\t\t\tlist_time_head_textshort_text_to_vid_timeline_md(\n\t\t\t\t\tlist_time_head_textshort_text, file, match1)\n'",
