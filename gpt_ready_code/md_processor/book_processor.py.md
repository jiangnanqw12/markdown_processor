"book_processor.py": "'import os\nimport re\nimport file_operations_utils\n# epub\ndef base_on_mulu_rename_mds(path=None):\n\tif path is None:\n\t\tpath = os.getcwd()\n\tmulu_name = "part0001.md"\n\tmulu_path = os.path.join(path, mulu_name)\n\tif not os.path.exists(mulu_path):\n\t\traise ValueError("no mulu file")\n\twith open(mulu_path, \'r\', encoding=\'utf-8\') as f:\n\t\tcontent = f.read()\n\treg_string1 = r"\\[(.+?)\\]\\(.+?(part)\\)"\n# zhi\ndef lower_header_level_in_md_files(path=None):\n\tif path is None:\n\t\tpath = os.getcwd()\n\tfiles_md = [f for f in os.listdir(path) if f.endswith(\'.md\')]\n\treg_string_head = re.compile(r"(#{1,6}) (.+)")\n\t# what is compile\n\tfor file in files_md:\n\t\ttry:\n\t\t\twith open(os.path.join(path, file), "r", encoding="utf-8") as f:\n\t\t\t\tlines = f.readlines()\n\t\t\tprocessed_lines = []\n\t\t\tfor line in lines:\n\t\t\t\tmatch = reg_string_head.search(line)\n\t\t\t\tif match:\n\t\t\t\t\tstring_sharp = match.group(1)\n\t\t\t\t\thead_num = string_sharp.count("#")\n\t\t\t\t\tline = reg_string_head.sub(\n\t\t\t\t\t\t(head_num + 1) * "#" + r" \\2", line)\n\t\t\t\tprocessed_lines.append(line)\n\t\t\twith open(os.path.join(path, file), "w", encoding="utf-8") as f:\n\t\t\t\tf.writelines(processed_lines)\n\t\texcept Exception as e:\n\t\t\tprint(f"Failed to process file {file} due to {str(e)}")\ndef prepend_filename_as_header_if_chapter_present(directory=None):\n\treg_string1 = r"\\d{3}_(第.{1,2}章.+)"\n\treg_string2 = r"\\d{3}_(\\d{1,2} .+)\\.md"\n\tif directory is None:\n\t\tdirectory = os.getcwd()\n\treg_string = reg_string2\n\tfiles_md = [f for f in os.listdir(directory) if f.endswith(\'.md\')]\n\t# Iterate over all files in the directory\n\tfor filename in files_md:\n\t\t# If the filename contains \'Chapter\'\n\t\tmatch = re.search(reg_string, filename)\n\t\tif match:\n\t\t\tchapter_name = match.group(1)\n\t\t\tprint(chapter_name)\n\t\t\t# Open the file and read its contents\n\t\t\twith open(os.path.join(directory, filename), \'r\', encoding="utf-8") as f:\n\t\t\t\tcontent = f.readlines()\n\t\t\t# Prepend the filename as a level 2 header\n\t\t\tcontent.insert(0, f\'## {chapter_name}\\n\')\n\t\t\t# Write the modified content back to the file\n\t\t\twith open(os.path.join(directory, filename), \'w\', encoding="utf-8") as f:\n\t\t\t\tf.writelines(content)\ndef remove_md_copy_code(path=None):\n\tif path is None:\n\t\tpath = os.getcwd()\n\treg_string_copy_code = [r"```\\n(.+)Copy code", r"```\\1\\n"]\n\treg_string_list = []\n\treg_string_list.append(reg_string_copy_code)\n\tfiles_md = [f for f in os.listdir(path) if f.endswith(\'.md\')]\n\tfile_operations_utils.perform_regex_replacement_on_files(\n\t\treg_string_list, path, files_md)\ndef perform_regex_replacement_on_index_file(directory_path=None):\n\t"""\n\tThis function checks for the existence of an index file in the given directory\n\tpath and performs a regex replacement on it.\n\tArgs:\n\t\tdirectory_path: Path to the directory to check. Defaults to the current working directory.\n\tRaises:\n\t\tFileNotFoundError: If the index file is not found in the directory.\n\t"""\n\tif directory_path is None:\n\t\tdirectory_path = os.getcwd()\n\tindex_filename = "000_index.md"\n\tif index_filename not in os.listdir(directory_path):\n\t\traise FileNotFoundError("Index file not found")\n\tfile_paths = [os.path.join(directory_path, index_filename)]\n\tregex_patterns = [(r"- \\[(.+)\\]\\(.+\\)", r"\\1")]\n\tfile_operations_utils.perform_regex_replacement_on_files(\n\t\tregex_patterns, directory_path, file_paths)\ndef perform_regex_replacement_on_zhi_mds(directory_path=None):\n\tif directory_path is None:\n\t\tdirectory_path = os.getcwd()\n\tfiles_md = [f for f in os.listdir(directory_path) if f.endswith(\'.md\')]\n\treg_string_list = []\n\treg_index_link = [\n\t\tr"-\\s+\\[.+\\]\\(https://www.zhihu.com/pub/reader/.+\\)\\n", r""]\n\treg_string_list.extend([reg_index_link])\n\treg_zhi_sao_ma = [\n\t\tr"扫码下载知乎APP 客户端\\n\\n!\\[\\]\\(.+sidebar-download-qrcode.wybWudky.png\\)\\n", r""]\n\treg_string_list.extend([reg_zhi_sao_ma])\n\treg_Back_matter_template = [r"---\\n\\n- created:.+\\n- source: .+", r""]\n\treg_string_list.extend([reg_Back_matter_template])\n\tfile_operations_utils.perform_regex_replacement_on_files(\n\t\treg_string_list, directory_path, files_md)\ndef convert_zhi_footnote_to_obsidian(directory_path=None):\n\tif directory_path is None:\n\t\tdirectory_path = os.getcwd()\n\tfiles_md = [f for f in os.listdir(directory_path) if f.endswith(\'.md\')]\n\treg_string_list = []\n\t# r"[\\[1\\]](https://www.zhihu.com/pub/reader/120057501/chapter/1302455544230445056#n1s) 在英语中，发散一词是diffuse。注意focused（专注）一词的词尾是-ed，而diffuse则不是。发散一词的意思是“薄薄地弥漫出去”。"\n\treg_string1 = [\n\t\tr\'<sup><a href="https://www\\.zhihu\\.com/pub/reader.+n\\d{1,2}" id="n\\d{1,2}s">\\[(\\d{1,2})\\]</a></sup>\', r"[^\\1]"]\n\t# r\'<sup><a href="https://www\\.zhihu\\.com/pub/reader.+n\\d{1,2}" id="n\\d{1,2}s">\\[\\d{1,2}\\]</a></sup>\'\n\treg_string_list.extend([reg_string1])\n\treg_string2 = [\n\t\tr\'\\[\\\\\\[(\\d{1,2})\\\\\\]\\]\\(https://www\\.zhihu\\.com/pub/.+\\) (.+)\', r"[^\\1]: (\\2)"]\n\treg_string_list.extend([reg_string2])\n\tfile_operations_utils.perform_regex_replacement_on_files(\n\t\treg_string_list, directory_path, files_md)\ndef perform_regex_replacement_on_zhi_book_mds_name(path=None):\n\tif path is None:\n\t\tpath = os.getcwd()\n\tfiles_md = [f for f in os.listdir(path) if f.endswith(\'.md\')]\n\treg_string_dir = [r"(.+) - .+ - 知乎书店", r"\\1"]\n\treg_string_md = [r"(.+) - .+ - 知乎书店(\\.md)", r"\\1\\2"]\n\treg_string_md2 = [r"{ (.+) }", r"{\\1}"]\n\treg_string_list = []\n\treg_string_list.append(reg_string_md)\n\tfile_operations_utils.perform_regex_rename_on_files(\n\t\treg_string_list, path, files_md)\n\tdirs = [directory for directory in os.listdir(\n\t\tpath) if os.path.isdir(directory)]\n\treg_string_list = []\n\treg_string_list.append(reg_string_dir)\n\tfile_operations_utils.perform_regex_rename_on_files(\n\t\treg_string_list, path, dirs)\ndef num2str_title(num):\n\treturn str(num).zfill(3)\ndef rename_files_base_on_index_markdown(path=None):\n\tcounter = 0\n\tif path is None:\n\t\tpath = os.getcwd()\n\twith open(os.path.join(path, "000_index.md"), \'r\', encoding=\'UTF-8\') as f:\n\t\tlines = f.readlines()\n\tfiles = os.listdir(path)\n\tfor i, line in enumerate(lines):\n\t\tline = line.strip().replace("%", "_")\n\t\tnote_name = line + \'.md\'\n\t\tif note_name in files:\n\t\t\tcounter += 1\n\t\t\tos.replace(os.path.join(path, note_name),\n\t\t\t\t\t   os.path.join(path, num2str_title(counter) + "_" + note_name))\n\t\telse:\n\t\t\tprint(files)\n\t\t\traise FileNotFoundError(f"{note_name} not in the files list")\ndef get_md_files(directory=\'.\'):\n\t"""Return a sorted list of markdown filenames in a given directory."""\n\tfiles = [f for f in os.listdir(directory) if f.endswith(\'.md\')]\n\t# Extract numeric prefix and sort based on it\n\tfiles.sort(key=lambda x: int(re.match(r\'(\\d{3})_\', x).group(\n\t\t1)) if re.match(r\'(\\d{3})_\', x) else float(\'inf\'))\n\treturn files\ndef check_md_files(files):\n\t# Check if files are in expected order\n\tfor i, filename in enumerate(files):\n\t\texpected_prefix = f"{i:03d}_"\n\t\tif not filename.startswith(expected_prefix):\n\t\t\tprint(\n\t\t\t\tf"Warning: {filename} does not match expected prefix {expected_prefix}")\ndef merge_files(filenames, output_filename):\n\t"""Merge the content of a list of files and write to a new file."""\n\twith open(output_filename, \'w\', encoding=\'utf-8\') as outfile:\n\t\tfor fname in filenames:\n\t\t\ttry:\n\t\t\t\twith open(fname, \'r\', encoding=\'utf-8\') as infile:\n\t\t\t\t\tcontent = infile.read()\n\t\t\t\t\toutfile.write(content)\n\t\t\t\t\toutfile.write(\'\\n\')  # add blank lines between files\n\t\t\texcept IOError:\n\t\t\t\tprint(f\'Error opening file {fname}, skipping.\')\ndef merge_all_md_files_into_one():\n\t"""Merge all markdown files in the current directory into one file."""\n\troot_path, root_dir = file_operations_utils.get_assets_root_path()\n\toutput_file = os.path.join(root_path, root_dir+".md")\n\tmd_files = get_md_files()\n\tcheck_md_files(md_files)\n\tmerge_files(md_files, output_file)\ndef Merge_all_md_files_into_one_file_base_on_num_index():\n\tfiles = [f for f in os.listdir() if f.endswith(\'.md\')]\n\tfiles.sort()\n\tprint(files)\n\troot_path, root_dir = file_operations_utils.get_assets_root_path()\n\twith open(os.path.join(root_path, root_dir+".md"), \'w\', encoding=\'utf-8\') as f:\n\t\tfor file in files:\n\t\t\twith open(file, \'r\', encoding=\'utf-8\') as f2:\n\t\t\t\tcontent = f2.read()\n\t\t\t\tf.write(content)\n\t\t\t\tf.write(\'\\n\\n\')\n'",
